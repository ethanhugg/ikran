<html>
<head>
    <title>Ikran!</title>
    <script type="application/javascript;version=1.8">
        let Me = window.navigator.service.call;
    </script>
</head>
	<body onLoad="pageLoad()" style="margin:10px 0px;padding:0px;text-align:center;">
	<h2>Ikran Example</h2>
	<canvas id="thecanvas" width="640" height="480"></canvas>
	<div>
	<input type="radio" id="regradio" name="reg" value="Register" checked onClick="serverRadioClick()"> Register Mode<br>
	<input type="radio" id="p2pradio" name="reg" value="P2P" onClick="p2pRadioClick()"> P2P Mode<br>
	</div>
	<div id="registerDiv">
	<p>Sip Server IP Address: <input type="text" id="regipaddress" /></p>
	<p>My username or DN: <input type="text" id="mydn" /></p>
	<p>My password (Not for CUCM): <input type="text" id="mypass"  /></p>
	<p>My device name(Needed for CUCM): <input type="text" id="mydevice" /></p>
	</div>
	
	<div id="p2pDiv">
	<p>My username or DN: <input type="text" id="p2pmydn" /></p>
	</div>
	
	<p><input type="button" id="regbutton" value="Register\Start Session!"/></p>
	<p>DN to Call: <input type="text" id="dn" /></p>
	<div id="p2pDiv2">
	<p>IP Address to Call: <input type="text" id="p2pipaddress" /></p>
	</div>
	<p><input type="button" id="callbutton" value="Place Call !"/></p>
	<p id="tehmsg"></p>

</body>
<script type="application/javascript;version=1.8">
    let Re = false;
    let ReRe = false;
    let msg = document.getElementById("tehmsg");
    let regbut = document.getElementById("regbutton");
    let callbut = document.getElementById("callbutton");
    let registerradio = document.getElementById("regradio");
    let p2pradio = document.getElementById("p2pradio");
    let regipaddress = document.getElementById("regipaddress");
    let dn = document.getElementById("dn");
    let mydn = document.getElementById("mydn");
    let mypass = document.getElementById("mypass");
    let mydevice = document.getElementById("mydevice");
    let p2pmydn = document.getElementById("p2pmydn");
    let p2pipaddress = document.getElementById("p2pipaddress");
    let ctx = document.getElementById("thecanvas").getContext("2d");
    
    function pageLoad() {
    	ctx.drawImage(img, 192, 112);
    	serverRadioClick();
    }
    function serverRadioClick() {
	document.getElementById("registerDiv").style.display = '';
	document.getElementById("p2pDiv").style.display = 'none';
	document.getElementById("p2pDiv2").style.display = 'none';
    }
    function p2pRadioClick() {
	document.getElementById("registerDiv").style.display = 'none';
	document.getElementById("p2pDiv").style.display = '';
	document.getElementById("p2pDiv2").style.display = '';
    }
    function onSessionStateChange(type, arg) 
    {
	if(type == "incoming-call")
	{
	    alert(" incoming call ");
	    Me.answerCall(ctx,onMediaStateChange);
	    callbut.value = "End Call";
	    ReRe = true;
	    msg.innerHTML = type;
	} else {
	    msg.innerHTML = type;
	}
    }
    function onMediaStateChange(type, arg) {
	msg.innerHTML = type;
	if(type == "call-terminated")
	{
		callbut.value = "Place Call";
		ReRe = false;
	}
    }

    if (!Me) {
        msg.innerHTML = "The Ikran add-on could not be loaded!";
    }
    
    regbut.onclick = function() {
	//alert(" in registration ");
        if (Re) {
            // Stop recording
            Me.unregisterUser();
 	    msg.innerHTML = " Unregistered ";
	    Re = false;
            regbut.value = "Register !";
        } else {
            Re = true;
            regbut.value = "UnRegister !";
            msg.innerHTML = "Atempting 2 Register...";
            
            if (registerradio.checked) {
            
            	Me.registerUser(mydevice.value, mydn.value, mypass.value, regipaddress.value, onSessionStateChange);
            
            } else { 
            
            	// Start in P2P Mode
            	Me.startP2PMode(p2pmydn.value, onSessionStateChange);
            }        
            
            msg.innerHTML = "Registered...";
        }
    }
    callbut.onclick = function() {
        if (ReRe) {
            // Stop recording
            Me.hangupCall();
            callbut.value = " Place Call!";
            msg.innerHTML = "Call Ended...";
			ReRe = false;
        } else {
            // Start recording
            ReRe = true;
            callbut.value = " End Call!";
            msg.innerHTML = "Placing Call...";
            
            if (registerradio.checked) {
            	Me.placeCall(dn.value, ctx, onMediaStateChange);
            	callbut.value = "End Call!";
            } else {
            	Me.placeP2PCall(dn.value, p2pipaddress.value, ctx, onMediaStateChange);
            }
        }
    }

</script>
</html>

